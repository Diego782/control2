(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const l of t.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(o){if(o.ep)return;o.ep=!0;const t=n(o);fetch(o.href,t)}})();const g=require("./gt06"),T=require("mqtt"),h=require("net"),u=require("express"),m=require("path"),i=u();require("fs");require("./crc16");const d={}.GT06_SERVER_PORT||4e3,R={}.MQTT_ROOT_TOPIC||"gt06",O={}.MQTT_BROKER_URL||"11ec3ffa829840c785105a23a3994db1.s1.eu.hivemq.cloud",P={}.MQTT_BROKER_PORT||1883,_={}.MQTT_BROKER_PROTO||"mqtt",q={}.MQTT_BROKER_USER||"DiegoGPS",v={}.MQTT_BROKER_PASSWD||"Dl1042248136!";var f=T.connect({host:O,port:P,protocol:_,username:q,password:v,connectTimeout:60*1e3});f.on("error",r=>{console.error("MQTT Error:",r)});let c;var p=h.createServer(r=>{var e=new g;console.log("client connected"),c=r,p.on("error",n=>{console.error("server error",n)}),r.on("error",n=>{console.error("client error",n)}),r.on("close",()=>{console.log("client disconnected"),c=null}),r.on("data",n=>{try{e.parse(n)}catch(s){console.log("err",s);return}e.event.string==="location"&&(console.log("Latitude:",e.lat),console.log("Longitude:",e.lon),console.log("Hora:",e.fixTime),console.log("Rumbo:",e.course),console.log("velocidad:",e.speed)),console.log(e),e.expectsResponse&&r.write(e.responseMsg),e.msgBuffer.forEach(s=>{f.publish(R+"/"+e.imei+"/pos",JSON.stringify(s))}),e.clearMsgBuffer()})});p.listen(d,()=>{console.log("started server on port:",d)});i.use(u.static(m.join(__dirname,"dist")));i.get("*",(r,e)=>{e.sendFile(m.join(__dirname,"dist","index.html"))});i.get("/send-command/:command",(r,e)=>{const n=r.params.command;c?(c.write(n),e.send(`Command ${n} sent to GPS`)):e.send("No GPS client connected")});function y(r){fetch(`/send-command/${r}`).then(e=>e.text()).then(e=>alert(e)).catch(e=>console.error("Error:",e))}const a=3e3;i.listen(a,()=>{console.log(`HTTP server is running on http://localhost:${a}`)});window.sendCommand=y;
